# Use new container infrastructure to enable caching
sudo: false

language: go

go:
  - 1.7.x
  - 1.8.x

env:
  global: PROJECT_NAME="reco"

install:
- go get github.com/Masterminds/glide
- make clean dependencies

script:
- make test benchmark integration

notifications:
  slack:
    secure: FWI4CFnCtckIol8jA9VBm7Fy/+X7sAIgDKwc4UY2ufBIFAQekPmSl6YXMvCRKa4w4ndSjxGA1wd1YwB/tNUPxMkGDb1DCI2/E21aaxB0iwD/CM6OPlxpORiZ3mitB1rlb206D4dKzk5OsltikIkYK2s5PJ/w2Ax8ayMgpOYclt2myJLpxxPE5LDfBQ9DPyOpKyzdZuhRtC0hry/U8t/1zGcXkmXidzcUhfA67BR2jjUOKYvwnqgDauI2hXzDBtpTcsQ4t4nrLdq6YhUXBpPuUAvqBC9G9svztO+9OPMmz4bRHayCU1UUDgryEGA2eX8QSlYIwfRAI6Eg7Vx2UyDncItcX2KXU4o1vRLsVT6202UeTSLH1htip6gA8e+FPsMRgSpXT8peGCNmRI95FfX0Ovw6x4/8yVOIC2mndXBW0bScnUnsdwuCXvR7sfhnu8w7KCMSUyHWhpew+ndKhoU6sad650wlRqZQQobTzLI5fEravUYDsZjSXBCXifaotGph38bP+fmJaGqZimq7zogEgZaS55WOHz2zF+K7YUZ0+FjCXsv1EYx6m5XERXQT7kJpuIB2hBDHcaCIeAnr0gGDNZq5AWtDtUMBd0aBpFZW04Hj4GN+GcNLPQjVtiJlgdXwqaZkiNHcCc/t9T+50bCtPuXHLPmE4/bMhFy7u/FHlf8=

branches:
  only:
  - master
  - auto
  - try
  - rollup
  # IMPORTANT Ruby regex to match tags. Required, or travis won't trigger deploys when a new tag
  # is pushed. This regex matches semantic versions like v1.2.3-rc4+2016.02.22
  - /^v\d+\.\d+\.\d+.*$/

before_deploy:
  - ./ci/cross_compile.sh $TRAVIS_BRANCH

deploy:
  - provider: s3
    access_key_id:
      secure: "ZSwZ2ReWY4owA0qxdsY9v7rZ9Ss9V9aMGz/QfmmfTkacLmzIcwl4xABYlcodVPdyMJnpmI0rgohql7rt2rwNcfV+vl4rYSq8DEU79saYJ7Q/VKjzmb5ss9hmB/5kVjN6zjineSvXz3IfesUecvMQv45SY0CcHHwH0p3c4TKC3/OjefTaGgpX0QrH/I5tZKK6zIp0lSTqaIUdvYEKkcbLXOdkTB29/Mumv3zAoKl/oXBcRj87OM2KeSuBwGBrW3kmCSvHk8XRraQvVi3PQ6Oj5tp8HgZTDC2CffGZWv02nsb2W8SoSAf/bXlAsvXoKSoUbO4DJZh1ZO70gpX3veWq3JBQrbdL2rg8mwdwJioQe7jaOuMRZ9KA6Rn1z3nEXKJ9yqT3RZhAr0JADgZ9SchSoBqDxOMoa70KidiLofBQabuhkeSktNhinhRZ3Ot7ctbjYcPOI7WNSPmdgchfXZXZlVek1xFif00g+J/Pp/BE6kIz3dZpcaknUM9qpiFyHuZUqVs4V2JFSMiHyvoyDN5TZjM2fbHlxQCpMdIZI26HLbZ7cdgYV06vfFGIRpjiZugbibNbldUF839BwwFT8u5W20zt/NvKoFAnNrCLZqd0fDQKm9ab+Ss6CN4BACTOR+kMu6jdIulHKkph/JzLY4IkO7brq6QM0vqXEOmd9Cz2PvA="
    secret_access_key:
      secure: "iK/xaA5006/ggde5UaBS+hpiY+oNZqc5yfI9kn1iPmGfYEFr9x9D4s8F2Qmg72ym98OEwLrbHX2uD4IgGBJ3yLz3eQHZJLLX78pM9OkMee3KyO07GZJM57eg2CpMHA3EYoq0x+HT1TGpBgAWlJA075psFFX3MaFFSD+ACYLqoz9ZBtUqI97/F+f/3O0jD6v2ZkhOhchnvxGUYyOkLd2TvKduMu5ypr50Tg6qm8WBcWvQzX79quiggEvdbToXj4HZ3rNhiXK56VljbkUaznzlXf+cbpnZ0Xn6ClBlAJU93NaGbUBtHg6JMBPFn+E/7LY3zDrvreoNUae3ZqrpsPsSehe8etp9dTx5Lkvf370v+gADU7icXUaCECYsQKX9detnJqSHCHWOKiWmFtYGeoZxBdoTHB3Haw6N7x7WOq/cm4APJQtzEt4hQ1lxokVSOKoS1Ed/BL1RMHVPdfDJHmzI7g7J73gBHqFOPVu0Au2gGSHtFsXMtOWRrJStDG8/aJu/rquf0r04/qB3NGRk4Awy/1ZUw00gLmtRh9nIS0ZgxAFCWTBWPel8FJIF3v4qw+bAhsnikujnW5kxMEC6bb2GeRAL1tv7+miYvH1zIMyQG8IekwRImuYBHjBR8QKC9ZivgHsX8XR7D3C1wXsMpBWYa2LtwvXC3dascSuc8Xp8iN8="
    acl: public_read
    bucket: reconfigure.io
    local_dir: $TRAVIS_BUILD_DIR/dist
    upload-dir: reco/releases
    skip_cleanup: true
    on:
      branch: master
      repo: ReconfigureIO/reco
  - provider: s3
    access_key_id:
      secure: "ZSwZ2ReWY4owA0qxdsY9v7rZ9Ss9V9aMGz/QfmmfTkacLmzIcwl4xABYlcodVPdyMJnpmI0rgohql7rt2rwNcfV+vl4rYSq8DEU79saYJ7Q/VKjzmb5ss9hmB/5kVjN6zjineSvXz3IfesUecvMQv45SY0CcHHwH0p3c4TKC3/OjefTaGgpX0QrH/I5tZKK6zIp0lSTqaIUdvYEKkcbLXOdkTB29/Mumv3zAoKl/oXBcRj87OM2KeSuBwGBrW3kmCSvHk8XRraQvVi3PQ6Oj5tp8HgZTDC2CffGZWv02nsb2W8SoSAf/bXlAsvXoKSoUbO4DJZh1ZO70gpX3veWq3JBQrbdL2rg8mwdwJioQe7jaOuMRZ9KA6Rn1z3nEXKJ9yqT3RZhAr0JADgZ9SchSoBqDxOMoa70KidiLofBQabuhkeSktNhinhRZ3Ot7ctbjYcPOI7WNSPmdgchfXZXZlVek1xFif00g+J/Pp/BE6kIz3dZpcaknUM9qpiFyHuZUqVs4V2JFSMiHyvoyDN5TZjM2fbHlxQCpMdIZI26HLbZ7cdgYV06vfFGIRpjiZugbibNbldUF839BwwFT8u5W20zt/NvKoFAnNrCLZqd0fDQKm9ab+Ss6CN4BACTOR+kMu6jdIulHKkph/JzLY4IkO7brq6QM0vqXEOmd9Cz2PvA="
    secret_access_key:
      secure: "iK/xaA5006/ggde5UaBS+hpiY+oNZqc5yfI9kn1iPmGfYEFr9x9D4s8F2Qmg72ym98OEwLrbHX2uD4IgGBJ3yLz3eQHZJLLX78pM9OkMee3KyO07GZJM57eg2CpMHA3EYoq0x+HT1TGpBgAWlJA075psFFX3MaFFSD+ACYLqoz9ZBtUqI97/F+f/3O0jD6v2ZkhOhchnvxGUYyOkLd2TvKduMu5ypr50Tg6qm8WBcWvQzX79quiggEvdbToXj4HZ3rNhiXK56VljbkUaznzlXf+cbpnZ0Xn6ClBlAJU93NaGbUBtHg6JMBPFn+E/7LY3zDrvreoNUae3ZqrpsPsSehe8etp9dTx5Lkvf370v+gADU7icXUaCECYsQKX9detnJqSHCHWOKiWmFtYGeoZxBdoTHB3Haw6N7x7WOq/cm4APJQtzEt4hQ1lxokVSOKoS1Ed/BL1RMHVPdfDJHmzI7g7J73gBHqFOPVu0Au2gGSHtFsXMtOWRrJStDG8/aJu/rquf0r04/qB3NGRk4Awy/1ZUw00gLmtRh9nIS0ZgxAFCWTBWPel8FJIF3v4qw+bAhsnikujnW5kxMEC6bb2GeRAL1tv7+miYvH1zIMyQG8IekwRImuYBHjBR8QKC9ZivgHsX8XR7D3C1wXsMpBWYa2LtwvXC3dascSuc8Xp8iN8="
    acl: public_read
    bucket: reconfigure.io
    local_dir: $TRAVIS_BUILD_DIR/dist
    upload-dir: reco/releases
    skip_cleanup: true
    on:
      repo: ReconfigureIO/reco
      tags: true

